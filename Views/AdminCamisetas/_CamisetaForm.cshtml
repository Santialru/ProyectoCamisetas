@model ProyectoCamisetas.Models.Camiseta
<div class="row g-3">
@{
    var __tallasList = ((IEnumerable<ProyectoCamisetas.Models.Talla>)ViewBag.TallasEnum);
    var __tallaVals = new HashSet<int>(__tallasList.Select(t => (int)t));
    var __add3XL = !__tallaVals.Contains(7);
    var __add4XL = !__tallaVals.Contains(8);
}
    <div class="col-md-6">
        <label asp-for="Nombre" class="form-label"></label>
        <input asp-for="Nombre" class="form-control" />
        <span asp-validation-for="Nombre" class="text-danger"></span>
    </div>
    <div class="col-md-6">
        <label asp-for="Equipo" class="form-label"></label>
        <input asp-for="Equipo" class="form-control" />
        <span asp-validation-for="Equipo" class="text-danger"></span>
    </div>
    <div class="col-md-4">
        <label asp-for="Liga" class="form-label"></label>
        <input asp-for="Liga" class="form-control" />
        <span asp-validation-for="Liga" class="text-danger"></span>
    </div>
    <div class="col-md-4">
        <label asp-for="Temporada" class="form-label"></label>
        <input asp-for="Temporada" class="form-control" />
        <span asp-validation-for="Temporada" class="text-danger"></span>
    </div>
    <div class="col-md-4">
        <label asp-for="Version" class="form-label"></label>
        <select asp-for="Version" asp-items="ViewBag.Versiones" class="form-select"></select>
    </div>
    <div class="col-md-4">
        <label asp-for="Tipo" class="form-label"></label>
        <select asp-for="Tipo" asp-items="ViewBag.Tipos" class="form-select"></select>
    </div>
    <div class="col-md-4">
        <label asp-for="Manga" class="form-label"></label>
        <select asp-for="Manga" asp-items="ViewBag.Mangas" class="form-select"></select>
    </div>
    <div class="col-md-4">
        <label asp-for="Marca" class="form-label"></label>
        <input asp-for="Marca" class="form-control" />
        <span asp-validation-for="Marca" class="text-danger"></span>
    </div>
    <div class="col-md-4">
        <label asp-for="Patrocinador" class="form-label"></label>
        <input asp-for="Patrocinador" class="form-control" />
    </div>
    <div class="col-md-4">
        <label asp-for="Material" class="form-label"></label>
        <input asp-for="Material" class="form-control" />
        <span asp-validation-for="Material" class="text-danger"></span>
    </div>
    <div class="col-md-3">
        <label asp-for="ColorPrincipal" class="form-label"></label>
        <input asp-for="ColorPrincipal" class="form-control" />
        <span asp-validation-for="ColorPrincipal" class="text-danger"></span>
    </div>
    <div class="col-md-3">
        <label asp-for="ColorSecundario" class="form-label"></label>
        <input asp-for="ColorSecundario" class="form-control" />
    </div>
    <div class="col-md-3">
        <label asp-for="Precio" class="form-label"></label>
        <input asp-for="Precio" class="form-control" />
        <span asp-validation-for="Precio" class="text-danger"></span>
    </div>
    <div class="col-12">
        <label class="form-label">Talles y stock</label>
        <div id="tallesContainer" class="row g-2">
            @if (Model.TallesStock != null && Model.TallesStock.Any())
            {
                foreach (var ts in Model.TallesStock)
                {
                    <div class="col-md-4 d-flex gap-2 align-items-center talla-row">
                        <select name="Tallas[]" class="form-select">
                            @foreach (var t in __tallasList)
                            {
                                if (t == ts.Talla)
                                {
                                    <option value="@((int)t)" selected="selected">@((t == ProyectoCamisetas.Models.Talla.Ninos) ? "Ni単os" : t.ToString())</option>
                                }
                                else
                                {
                                    <option value="@((int)t)">@((t == ProyectoCamisetas.Models.Talla.Ninos) ? "Ni単os" : t.ToString())</option>
                                }
                            }
                            @if (__add3XL)
                            {
                                <option value="7" selected="@(((int)ts.Talla) == 7 ? "selected" : null)">XXXL</option>
                            }
                            @if (__add4XL)
                            {
                                <option value="8" selected="@(((int)ts.Talla) == 8 ? "selected" : null)">XXXXL</option>
                            }
                        </select>
                        <input name="Cantidades[]" type="number" min="0" class="form-control" value="@ts.Cantidad" placeholder="Cant." />
                        <button type="button" class="btn btn-outline-danger remove-talla">&times;</button>
                    </div>
                }
            }
            else
            {
                <div class="col-md-4 d-flex gap-2 align-items-center talla-row">
                    <select name="Tallas[]" class="form-select">
                        @foreach (var t in __tallasList)
                        {
                            <option value="@((int)t)">@((t == ProyectoCamisetas.Models.Talla.Ninos) ? "Ni単os" : t.ToString())</option>
                        }
                        @if (__add3XL)
                        {
                            <option value="7">XXXL</option>
                        }
                        @if (__add4XL)
                        {
                            <option value="8">XXXXL</option>
                        }
                    </select>
                    <input name="Cantidades[]" type="number" min="0" class="form-control" value="0" placeholder="Cant." />
                    <button type="button" class="btn btn-outline-danger remove-talla">&times;</button>
                </div>
            }
        </div>
        <div id="tallaRowTemplate" class="d-none">
            <div class="col-md-4 d-flex gap-2 align-items-center talla-row">
                <select name="Tallas[]" class="form-select">
                    @foreach (var t in __tallasList)
                    {
                        <option value="@((int)t)">@((t == ProyectoCamisetas.Models.Talla.Ninos) ? "Ni単os" : t.ToString())</option>
                    }
                    @if (__add3XL)
                    {
                        <option value="7">XXXL</option>
                    }
                    @if (__add4XL)
                    {
                        <option value="8">XXXXL</option>
                    }
                </select>
                <input name="Cantidades[]" type="number" min="0" class="form-control" value="0" placeholder="Cant." />
                <button type="button" class="btn btn-outline-danger remove-talla">&times;</button>
            </div>
        </div>
        <button type="button" id="addTalla" class="btn btn-outline-secondary btn-sm mt-2">Agregar talla</button>
    </div>
    <div class="col-md-4">
        <label asp-for="SKU" class="form-label"></label>
        <input asp-for="SKU" class="form-control" />
        <span asp-validation-for="SKU" class="text-danger"></span>
    </div>
    <div class="col-md-4">
        <label asp-for="FechaLanzamiento" class="form-label"></label>
        <input asp-for="FechaLanzamiento" type="date" class="form-control" />
    </div>
    <div class="col-md-4">
        <label asp-for="TipoCuello" class="form-label"></label>
        <input asp-for="TipoCuello" class="form-control" />
    </div>
    <div class="col-md-4">
        <label asp-for="Jugador" class="form-label"></label>
        <input asp-for="Jugador" class="form-control" />
    </div>
    <div class="col-md-2">
        <label asp-for="Numero" class="form-label"></label>
        <input asp-for="Numero" class="form-control" />
    </div>
    <!-- Imagen principal ya no se ingresa por URL -->
    <input type="hidden" asp-for="ImagenUrl" />
    <div class="col-12">
        <label asp-for="Descripcion" class="form-label"></label>
        <textarea asp-for="Descripcion" rows="3" class="form-control"></textarea>
    </div>
    <div class="col-md-4 form-check">
        <input asp-for="EsEdicionLimitada" class="form-check-input" />
        <label asp-for="EsEdicionLimitada" class="form-check-label"></label>
    </div>
    <div class="col-md-4 form-check">
        <input asp-for="EsPersonalizada" class="form-check-input" />
        <label asp-for="EsPersonalizada" class="form-check-label"></label>
    </div>
    <div class="col-md-4">
        <label asp-for="CodigoBarras" class="form-label"></label>
        <input asp-for="CodigoBarras" class="form-control" />
    </div>
</div>
<script>
    (function(){
        const cont = document.getElementById('tallesContainer');
        const addBtn = document.getElementById('addTalla');
        const tpl = document.getElementById('tallaRowTemplate');
        if (!cont || !addBtn || !tpl) return;
        addBtn.addEventListener('click', function(){
            const node = tpl.firstElementChild.cloneNode(true);
            cont.appendChild(node);
        });
        cont.addEventListener('click', function(e){
            if (e.target && e.target.classList.contains('remove-talla')){
                const row = e.target.closest('.talla-row');
                if (row) row.remove();
            }
        });
    })();
    </script>
